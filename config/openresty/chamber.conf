# worker_processes auto;

# error_log  /proc/self/fd/2 error;

# events {
#   worker_connections 65536;
#   use                epoll;
#   multi_accept       on;
# }

# http {
#   include                     mime.types;
#   default_type                application/octet-stream;
#   error_log                   off;
#   server_tokens               off;
#   sendfile                    on;
#   tcp_nopush                  on;
#   tcp_nodelay                 on;
#   client_body_buffer_size     128k;
#   client_max_body_size        10m;
#   client_header_buffer_size   1k;
#   large_client_header_buffers 4 4k;
#   output_buffers              1 32k;
#   client_header_timeout       3m;
#   client_body_timeout         3m;
#   send_timeout                3m;
#   open_file_cache             max=1000 inactive=20s;
#   open_file_cache_valid       30s;
#   open_file_cache_min_uses    5;
#   open_file_cache_errors      off;
#   keepalive_timeout           65;
#   keepalive_requests          100000;

  server {
    listen       80;
    server_name  localhost;

    chunked_transfer_encoding off;
    gzip_static               on;
    gzip_http_version         1.1;
    gzip_proxied              expired no-cache no-store private auth;
    gzip_vary                 on;

    location / {
      default_type text/html;
      echo -n "<!DOCTYPE html><html lang='en'><head><meta name='apple-mobile-web-app-capable' content='yes' \><meta http-equiv='refresh' content='15' \><meta charset='utf-8' \><title>Chamber</title></head><style>"
      echo -n "*{margin:0;padding:0}body,html{width:100%;height:100%;background-color:#000}.wrapper{width:100%;height:100%;display:flex;justify-content:center;align-items:center}.wrapper h1.glitch{color:#fff;font-family:sans-serif;font-weight:800;position:relative;font-size:100px;padding:30px}.wrapper h1.glitch::after,.wrapper h1.glitch::before{padding:30px;color:#fff;content:'{ chamber }';position:absolute;width:100%;height:100%;background:#000;overflow:hidden;top:0}.wrapper h1.glitch::before{left:3px;text-shadow:-2px 0 red;animation-name:glitch-animation-1;animation-duration:2s;animation-timing-function:linear;animation-delay:0s;animation-iteration-count:infinite;animation-direction:reverse-alternate}.wrapper h1.glitch::after{left:-3px;text-shadow:-2px 0 #00f;animation-name:glitch-animation-2;animation-duration:2s;animation-timing-function:linear;animation-delay:0s;animation-iteration-count:infinite;animation-direction:reverse-alternate}"
      echo -n "@keyframes glitch-animation-1{0%{clip:rect(36px,600px,94px,30px)}5%{clip:rect(120px,600px,5px,30px)}10%{clip:rect(116px,600px,138px,30px)}15%{clip:rect(10px,600px,40px,30px)}20%{clip:rect(82px,600px,100px,30px)}25%{clip:rect(149px,600px,17px,30px)}30%{clip:rect(38px,600px,7px,30px)}35%{clip:rect(125px,600px,110px,30px)}40%{clip:rect(63px,600px,41px,30px)}45%{clip:rect(27px,600px,50px,30px)}50%{clip:rect(81px,600px,101px,30px)}55%{clip:rect(129px,600px,44px,30px)}60%{clip:rect(7px,600px,96px,30px)}65%{clip:rect(124px,600px,71px,30px)}70%{clip:rect(6px,600px,88px,30px)}75%{clip:rect(89px,600px,65px,30px)}80%{clip:rect(138px,600px,2px,30px)}85%{clip:rect(62px,600px,57px,30px)}90%{clip:rect(109px,600px,70px,30px)}95%{clip:rect(116px,600px,19px,30px)}100%{clip:rect(130px,600px,52px,30px)}}@keyframes glitch-animation-2{0%{clip:rect(29px,600px,93px,30px)}5%{clip:rect(14px,600px,68px,30px)}10%{clip:rect(94px,600px,40px,30px)}15%{clip:rect(4px,600px,58px,30px)}20%{clip:rect(1px,600px,28px,30px)}25%{clip:rect(39px,600px,11px,30px)}30%{clip:rect(45px,600px,93px,30px)}35%{clip:rect(83px,600px,94px,30px)}40%{clip:rect(39px,600px,110px,30px)}45%{clip:rect(95px,600px,88px,30px)}50%{clip:rect(96px,600px,103px,30px)}55%{clip:rect(17px,600px,29px,30px)}60%{clip:rect(53px,600px,1px,30px)}65%{clip:rect(129px,600px,128px,30px)}70%{clip:rect(74px,600px,105px,30px)}75%{clip:rect(40px,600px,48px,30px)}80%{clip:rect(90px,600px,52px,30px)}85%{clip:rect(57px,600px,83px,30px)}90%{clip:rect(39px,600px,143px,30px)}95%{clip:rect(25px,600px,87px,30px)}100%{clip:rect(128px,600px,91px,30px)}}"
      echo -n "</style><body><div class='wrapper' data-text='{ chamber }'><h1 class='glitch'>{ chamber }</h1></div></body></html>";
    }

    location /auth {
      default_type text/html;
      auth_basic "Restricted";
      auth_basic_user_file /etc/nginx/.htpasswd;
    }

    location /slow {
      default_type application/json;
      echo_sleep 5;
      echo "{\"elapsed\": \"$echo_timer_elapsed\"}";
    }

    location /slower {
      default_type application/json;
      echo_sleep 10;
      echo "{\"elapsed\": \"$echo_timer_elapsed\"}";
    }

    location /slowest {
      default_type application/json;
      echo_sleep 20;
      echo "{\"elapsed\": \"$echo_timer_elapsed\"}";
    }

    location /headers {
      default_type application/json;
      content_by_lua_block {
        items = {}
        for k, v in pairs(ngx.req.get_headers()) do
          table.insert(items, string.format('{"key": "%s", "value": "%s"}', string.upper(k), v))
        end

        ngx.say('[', table.concat(items, ','), ']')
      }
    }

    location /body {
      default_type text/html;
      echo "<pre>$request_body</pre>";
    }

    location /body/large {
      default_type text/html;
      echo_duplicate 150_000 "echo ";
    }

    location /body/xlarge {
      default_type text/html;
      echo_duplicate 1_500_000 "echo ";
    }

    location /body/xxlarge {
      default_type text/html;
      echo_duplicate 15_000_000 "echo ";
    }

    location /status {
      stub_status on;
    }

    location /up {
      default_type text/html;
      return 200;
    }

    # HTTP/1.1 2xx
    location /code/200 {
      return 200 "HTTP/1.1 200 OK";
    }

    location /code/201 {
      return 201 "HTTP/1.1 201 Created";
    }

    location /code/202 {
      return 202 "HTTP/1.1 202 Accepted";
    }

    location /code/203 {
      return 203 "HTTP/1.1 203 Non-Authoritative Information";
    }

    location /code/204 {
      return 204 "HTTP/1.1 204 No Content";
    }

    location /code/205 {
      return 205 "HTTP/1.1 205 Reset Content";
    }

    location /code/206 {
      return 206 "HTTP/1.1 206 Partial Content";
    }

    location /code/207 {
      return 207 "HTTP/1.1 207 Multi-Status";
    }

    location /code/208 {
      return 208 "HTTP/1.1 208 Already Reported";
    }

    location /code/226 {
      return 226 "HTTP/1.1 226 IM Used";
    }

    # HTTP/1.1 3xx
    location /code/300 {
      return 300 "HTTP/1.1 300 Multiple Choices";
    }

    location /code/301 {
      return 301 "HTTP/1.1 301 Moved Permanently";
    }

    location /code/302 {
      return 302 "HTTP/1.1 302 Found";
    }

    location /code/303 {
      return 303 "HTTP/1.1 303 See Other";
    }

    location /code/304 {
      return 304 "HTTP/1.1 304 Not Modified";
    }

    location /code/305 {
      return 305 "HTTP/1.1 305 Use Proxy";
    }

    location /code/306 {
      return 306 "HTTP/1.1 306 Switch Proxy";
    }

    location /code/307 {
      return 307 "HTTP/1.1 307 Temporary Redirect";
    }

    location /code/308 {
      return 308 "HTTP/1.1 308 Permanent Redirect";
    }
  }